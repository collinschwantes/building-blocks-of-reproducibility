---
title: "Building Blocks of Reproducibility: renv"
author: "Collin Schwantes"
date: "`r Sys.Date()`"
output:
  ehastyle::eha_avenir_xar
---

# Review from previous talks

**Reproducibility** is the ability to re-create results from the same data and code

1)  Use an IDE like Rstudio   
2)  Always start from a blank slate (save source not sessions)
3)  Use projects and relative paths  
4)  Keep your code organized (avoid spaghetti code)  
5)  Leave yourself notes (literate programming)  
6)  Use a version control system  

???
In the context of reproducible research software, reproducibility is the ability to recreate results from the same code and data. 


---

# But wait

How many packages do you use in your projects?

???

---

# Problem

How do you create reproducible workflows when MOST of the code in your project comes from outside sources?

---

# Solution `renv`

- Simple and powerful package management system
- Allows you to create local project specific package libraries
- Allows you to share specific packages used with collaborators

---

# Things to keep in mind

`renv` does not fully capture your compute environment  
1. System libraries  
2. System dependencies  
3. R version  


???

Renv is not a complete solution to reproducibility problems but it helps! A future session on containerizing code will help get us most of the way to fully capturing the compute environment for a project. 
---
# Basic `renv` workflow

- Create project in Rstudio
```
renv::init() #setup renv infrastructure in your project
```
- Work on code, install packages
``` 
renv::snapshopt() # record the package versions at that point in time >> save
```
- What did I do?
```
renv::status() # check which packages have been added or modified
```

- Oops - I want to go back 
```
renv::restore() # restore packages from lock.file >> load
```
---

# What happens when on `renv::init()`?


| **File**            | **Usage**                                                                           |
| -----------------   | ----------------------------------------------------------------------------------- |
| `.Rprofile`         | *Used to activate `renv` for new R sessions launched in the project.                 |
| `renv.lock`         | *The lockfile, describing the state of your project's library at some point in time. |
| `renv/activate.R`   | The activation script run by the project `.Rprofile`.                               |
| `renv/library`      | The private project library.                                                        |
| `renv/settings.dcf` | Project settings -- see `?settings` for more details.                               |

*files you will likely interact with

???

creates files and folders necessary to capture package dependencies.
---

# How do I collaborate with `renv`?

- Use git/github as version control - `renv` will ignore any package dependencies declared in `.gitignore`'d locations
- Whoever creates the project runs `renv::init()` followed by
`renv::snapshot()` and pushes the renv files to github
- Collaborators pull down files and use `renv::restore()` to install the specific  package versions on their machines and `renv::snapshot()` to update the `lock.file` then push changes to github

---
# What if my collaborators use Windows? 

- They need to run `renv::equip()` to install necessary compiling tools (e.g. rtools) - this should handle most use cases
- If packages won't download properly modify the download methods
```{r eval=FALSE}
# in the console
usethis::edit_renviron() 
# in the .Renviron file set - don't forget the trailing return
RENV_DOWNLOAD_METHOD = "libcurl" # or wininet

```
- If need be, you can setup a separate "windows" .Rprofile and use `renv::activate(profile = "windows")`
